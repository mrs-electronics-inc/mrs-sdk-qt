#cloud-config
autoinstall:
  version: 1
  interactive-sections: []
  locale: en_US.UTF-8
  keyboard:
    layout: us
  network:
    version: 2
    ethernets:
      ens3:
        dhcp4: true
  storage:
    layout:
      name: direct
    swap:
      size: 0
  identity:
    hostname: mrs-sdk-qt
    username: ubuntu
    password: $6$wXSWO.tB/0LFwxhf$HHDKH9ptNthCDMaNbX49SEEtt.Pj.sKRBFpKdDPTHcUDDD2IA2VrpDodh.iiCOrvnzVmDzFujP0Z.o6PLHH8R0
    realname: Ubuntu User
  ssh:
    install-server: true
    allow-pw: true
    enabled: true
  packages:
    - openssh-server
    - openssh-client
    - linux-generic
    - git
    - curl
    - wget
  updates: security
  timezone: UTC
  grub:
    install: true
  late-commands:
    - 'sed -i "s/#PermitRootLogin.*/PermitRootLogin yes/" /target/etc/ssh/sshd_config'
    - 'curtin in-target -- systemctl enable ssh'
    - 'curtin in-target -- systemctl start ssh'
    - 'sleep 30'
    - 'curtin in-target -- chown -R ubuntu:ubuntu /home/ubuntu'
    - 'curtin in-target -- apt-get update'
    - 'curtin in-target -- apt-get install -y ubuntu-desktop 2>&1 | tee /dev/console'
    - 'curtin in-target -- apt-get install -y build-essential qtcreator python3-pip pipx 2>&1 | tee /dev/console'
    - 'curtin in-target -- sudo -u ubuntu pipx install aqtinstall 2>&1 | tee /dev/console'
    - 'curtin in-target -- sudo -u ubuntu ~/.local/bin/aqt install-qt linux desktop 5.15.0 2>&1 | tee /dev/console'
    - 'curtin in-target -- sudo -u ubuntu ~/.local/bin/aqt install-qt linux desktop 6.8.0 2>&1 | tee /dev/console'
    - 'curtin in-target -- apt-get autoremove -y'
    - 'curtin in-target -- apt-get autoclean -y'
    - 'curtin in-target -- apt-get clean -y'
    - 'curtin in-target -- sudo -u ubuntu git clone https://github.com/mrs-electronics-inc/mrs-sdk-qt /home/ubuntu/mrs-sdk-qt'
    - 'curtin in-target -- rm -rf /tmp/* /var/tmp/*'
