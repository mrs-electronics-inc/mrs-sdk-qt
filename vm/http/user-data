#cloud-config
autoinstall:
  version: 1
  interactive-sections: []
  locale: en_US.UTF-8
  keyboard:
    layout: us
  network:
    version: 2
    ethernets:
      ens3:
        dhcp4: true
  storage:
    layout:
      name: direct
    swap:
      size: 0
  identity:
    hostname: mrs-sdk-qt
    username: ubuntu
    password: $6$wXSWO.tB/0LFwxhf$HHDKH9ptNthCDMaNbX49SEEtt.Pj.sKRBFpKdDPTHcUDDD2IA2VrpDodh.iiCOrvnzVmDzFujP0Z.o6PLHH8R0
    realname: Ubuntu User
  ssh:
    install-server: true
    allow-pw: true
    enabled: true
  packages:
    - openssh-server
    - openssh-client
    - linux-generic
    - git
    - curl
    - wget
  updates: security
  timezone: UTC
  grub:
    install: true
  late-commands:
    - 'sed -i "s/#PermitRootLogin.*/PermitRootLogin yes/" /target/etc/ssh/sshd_config'
    - 'curtin in-target -- systemctl enable ssh'
    - 'curtin in-target -- systemctl start ssh'
    - 'curtin in-target -- echo "Waiting 30 seconds for network to come online..."'
    - 'sleep 30'
    - 'curtin in-target -- echo "Network configuration:" && ip -4 addr show ens3'
    - 'curtin in-target -- apt-get update'
    - 'curtin in-target -- apt-get install -y -o APT::Status-Fd=3 -o Debug::pkgProblemResolver=yes ubuntu-desktop 3>&1'
    - 'curtin in-target -- apt-get install -y -o APT::Status-Fd=3 -o Debug::pkgProblemResolver=yes qtcreator qtbase5-dev qt5-qmake 3>&1'
    - 'curtin in-target -- apt-get autoremove -y'
    - 'curtin in-target -- apt-get autoclean -y'
    - 'curtin in-target -- apt-get clean -y'
    - 'curtin in-target -- rm -rf /tmp/* /var/tmp/*'
